<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Nonlinear Least Squares Fit for CW-OSL curves -beta version- — fit_CWCurve • Luminescence</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Nonlinear Least Squares Fit for CW-OSL curves -beta version- — fit_CWCurve"><meta property="og:description" content="The function determines the weighted least-squares estimates of the
component parameters of a CW-OSL signal for a given maximum number of
components and returns various component parameters. The fitting procedure
uses the nls function with the port algorithm."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Luminescence</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.20</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/index.html">
    <span class="fa fa-play"></span>
     
    Articles
  </a>
</li>
<li>
  <a href="../reference/index.html">References</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/R-Lum/Luminescence" class="external-link">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Nonlinear Least Squares Fit for CW-OSL curves -beta version-</h1>
    <small class="dont-index">Source: <a href="https://github.com/R-Lum/Luminescence/blob/HEAD/R/fit_CWCurve.R" class="external-link"><code>R/fit_CWCurve.R</code></a></small>
    <div class="hidden name"><code>fit_CWCurve.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function determines the weighted least-squares estimates of the
component parameters of a CW-OSL signal for a given maximum number of
components and returns various component parameters. The fitting procedure
uses the <a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a> function with the <code>port</code> algorithm.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_CWCurve</span><span class="op">(</span></span>
<span>  <span class="va">values</span>,</span>
<span>  <span class="va">n.components.max</span>,</span>
<span>  fit.failure_threshold <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  fit.method <span class="op">=</span> <span class="st">"port"</span>,</span>
<span>  fit.trace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fit.calcError <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  LED.power <span class="op">=</span> <span class="fl">36</span>,</span>
<span>  LED.wavelength <span class="op">=</span> <span class="fl">470</span>,</span>
<span>  cex.global <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  sample_code <span class="op">=</span> <span class="st">"Default"</span>,</span>
<span>  <span class="va">output.path</span>,</span>
<span>  output.terminal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output.terminalAdvanced <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>values</dt>
<dd><p><a href="RLum.Data.Curve-class.html">RLum.Data.Curve</a> or <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> (<strong>required</strong>):
x, y data of measured values (time and counts). See examples.</p></dd>


<dt>n.components.max</dt>
<dd><p><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a> (<em>optional</em>):
maximum number of components that are to be used for fitting.
The upper limit is 7.</p></dd>


<dt>fit.failure_threshold</dt>
<dd><p><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a> (<em>with default</em>):
limits the failed fitting attempts.</p></dd>


<dt>fit.method</dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> (<em>with default</em>):
select fit method, allowed values: <code>'port'</code> and <code>'LM'</code>. <code>'port'</code> uses the 'port'
routine from the function <a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a> <code>'LM'</code> utilises the function <code>nlsLM</code> from
the package <code>minpack.lm</code> and with that the Levenberg-Marquardt algorithm.</p></dd>


<dt>fit.trace</dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
traces the fitting process on the terminal.</p></dd>


<dt>fit.calcError</dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
calculate 1-sigma error range of components using <a href="https://rdrr.io/r/stats/confint.html" class="external-link">stats::confint</a></p></dd>


<dt>LED.power</dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>):
LED power (max.) used for intensity ramping in mW/cm^2.
<strong>Note:</strong> The value is used for the calculation of the absolute
photoionisation cross section.</p></dd>


<dt>LED.wavelength</dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>):
LED wavelength used for stimulation in nm.
<strong>Note:</strong> The value is used for the calculation of the absolute
photoionisation cross section.</p></dd>


<dt>cex.global</dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>):
global scaling factor.</p></dd>


<dt>sample_code</dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> (<em>optional</em>):
sample code used for the plot and the optional output table (<code>mtext</code>).</p></dd>


<dt>output.path</dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> (<em>optional</em>):
output path for table output containing the results of the fit. The file
name is set automatically. If the file already exists in the directory,
the values are appended.</p></dd>


<dt>output.terminal</dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
terminal output with fitting results.</p></dd>


<dt>output.terminalAdvanced</dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
enhanced terminal output. Requires <code>output.terminal = TRUE</code>.
If <code>output.terminal = FALSE</code> no advanced output is possible.</p></dd>


<dt>plot</dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
returns a plot of the fitted curves.</p></dd>


<dt>...</dt>
<dd><p>further arguments and graphical parameters passed to <a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><strong>plot (<em>optional</em>)</strong></p>



<p>the fitted CW-OSL curves are returned as plot.</p>


<p><strong>table (<em>optional</em>)</strong></p>



<p>an output table (<code>*.csv</code>) with parameters of the fitted components is
provided if the <code>output.path</code> is set.</p>


<p><strong>RLum.Results</strong></p>



<p>Beside the plot and table output options, an <a href="RLum.Results-class.html">RLum.Results</a> object is
returned.</p>


<p><code>fit</code>:
an <code>nls</code> object (<code>$fit</code>) for which generic R functions are
provided, e.g. <a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a>, <a href="https://rdrr.io/r/stats/confint.html" class="external-link">stats::confint</a>, <a href="https://rdrr.io/r/stats/profile.html" class="external-link">profile</a>. For more
details, see <a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a>.</p>


<p><code>output.table</code>:
a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> containing the summarised parameters including the error</p>


<p><code>component.contribution.matrix</code>:
<a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a> containing the values for the component to sum contribution plot
(<code>$component.contribution.matrix</code>).</p>


<p>Matrix structure:<br></p>


<p>Column 1 and 2: time and <code>rev(time)</code> values <br></p>


<p>Additional columns are used for the components, two for each component,
containing I0 and n0. The last columns <code>cont.</code> provide information on
the relative component contribution for each time interval including the row
sum for this values.</p>


<p><strong>object</strong></p>



<p>beside the plot and table output options, an <a href="RLum.Results-class.html">RLum.Results</a> object
is returned.</p>


<p><code>fit</code>:
an <code>nls</code> object (<code>$fit</code>) for which generic R functions
are provided, e.g. <a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a>, <a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a>, <a href="https://rdrr.io/r/stats/profile.html" class="external-link">profile</a>. For more
details, see <a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a>.</p>


<p><code>output.table</code>:
a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> containing the summarised parameters including the error<br></p>


<p><code>component.contribution.matrix</code>: <a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a> containing the values
for the component to sum contribution plot (<code>$component.contribution.matrix</code>).<br></p>



<p>Matrix structure:<br></p>


<p>Column 1 and 2: time and <code>rev(time)</code> values<br></p>


<p>Additional columns are used for the components, two for each component,
containing I0 and n0. The last columns <code>cont.</code> provide information on
the relative component contribution for each time interval including the row
sum for this values.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><strong>Fitting function</strong></p>
<p>The function for the CW-OSL fitting has the general form:</p>
<p>$$y = I0_{1}*\lambda_{1}*exp(-\lambda_1*x) + ,\ldots, + I0_{i}*\lambda_{i}*exp(-\lambda_i*x) $$</p>
<p>where \(0 &lt; i &lt; 8\)</p>
<p>and \(\lambda\) is the decay constant <br>
and \(I0\) the initial number of trapped electrons.</p>
<p><em>(for the used equation cf. Boetter-Jensen et al., 2003, Eq. 2.31)</em></p>
<p><strong>Start values</strong></p>
<p>Start values are estimated automatically by fitting a linear function to the
logarithmized input data set. Currently, there is no option to manually
provide start parameters.</p>
<p><strong>Goodness of fit</strong></p>
<p>The goodness of the fit is given as pseudoR^2 value (pseudo coefficient of
determination). According to Lave (1970), the value is calculated as:</p>
<p>$$pseudoR^2 = 1 - RSS/TSS$$</p>
<p>where \(RSS = Residual~Sum~of~Squares\) <br>
and \(TSS = Total~Sum~of~Squares\)</p>
<p><strong>Error of fitted component parameters</strong></p>
<p>The 1-sigma error for the
components is calculated using the function <a href="https://rdrr.io/r/stats/confint.html" class="external-link">stats::confint</a>. Due to
considerable calculation time, this option is deactivated by default. In
addition, the error for the components can be estimated by using internal R
functions like <a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a>. See the <a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a> help page
for more information.</p>
<p><em>For details on the nonlinear regression in R, see Ritz &amp; Streibig (2008).</em></p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p><strong>Beta version - This function has not been properly tested yet and</strong>
<strong>should therefore not be used for publication purposes!</strong></p>
<p>The pseudo-R^2 may not be the best parameter to describe the goodness of the
fit. The trade off between the <code>n.components</code> and the pseudo-R^2 value
is currently not considered.</p>
<p>The function <strong>does not</strong> ensure that the fitting procedure has reached a
global minimum rather than a local minimum!</p>
    </div>
    <div id="function-version">
    <h2>Function version</h2>
    <p>0.5.2</p>
    </div>
    <div id="how-to-cite">
    <h2>How to cite</h2>
    <p>Kreutzer, S., 2022. fit_CWCurve(): Nonlinear Least Squares Fit for CW-OSL curves -beta version-. Function version 0.5.2. In: Kreutzer, S., Burow, C., Dietze, M., Fuchs, M.C., Schmidt, C., Fischer, M., Friedrich, J., Mercier, N., Philippe, A., Riedesel, S., Autzen, M., Mittelstrass, D., Gray, H.J., Galharret, J., 2022. Luminescence: Comprehensive Luminescence Dating Data Analysis. R package version 0.9.20. https://CRAN.R-project.org/package=Luminescence</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Boetter-Jensen, L., McKeever, S.W.S., Wintle, A.G., 2003.
Optically Stimulated Luminescence Dosimetry. Elsevier Science B.V.</p>
<p>Lave, C.A.T., 1970. The Demand for Urban Mass Transportation. The Review of
Economics and Statistics, 52 (3), 320-323.</p>
<p>Ritz, C. &amp; Streibig, J.C., 2008. Nonlinear Regression with R. In: R.
Gentleman, K. Hornik, G. Parmigiani, eds., Springer, p. 150.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="fit_LMCurve.html">fit_LMCurve</a>, <a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a>,<a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a>, <a href="RLum.Data.Curve-class.html">RLum.Data.Curve</a>,
<a href="RLum.Results-class.html">RLum.Results</a>, <a href="get_RLum.html">get_RLum</a>, <a href="https://rdrr.io/pkg/minpack.lm/man/nlsLM.html" class="external-link">minpack.lm::nlsLM</a></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Sebastian Kreutzer, Institute of Geography, Heidelberg University (Germany)
, RLum Developer Team</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##load data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ExampleData.CW_OSL_Curve</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##fit data</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">fit_CWCurve</span><span class="op">(</span>values <span class="op">=</span> <span class="va">ExampleData.CW_OSL_Curve</span>,</span></span>
<span class="r-in"><span>                   main <span class="op">=</span> <span class="st">"CW Curve Fit"</span>,</span></span>
<span class="r-in"><span>                   n.components.max <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                   log <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [fit_CWCurve()]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitting was finally done using a 3-component function (max=4):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y ~ I0.1 * lambda.1 * exp(-lambda.1 * x) + I0.2 * lambda.2 * exp(-lambda.2 * x) + I0.3 * lambda.3 * exp(-lambda.3 * x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          I0 I0.error    lambda lambda.error           cs cs.rel</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c1 2387.608       NA 4.5905460           NA 5.389403e-17 1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c2 1053.500       NA 1.9593743           NA 2.300349e-17 0.4268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c3 2816.625       NA 0.0205474           NA 2.412311e-19 0.0045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pseudo-R^2 = 0.9995</span>
<span class="r-plt img"><img src="fit_CWCurve-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Sebastian Kreutzer, Christoph Burow, Michael Dietze, Margret C. Fuchs, Christoph Schmidt, Manfred Fischer, Johannes Friedrich, Norbert Mercier, Anne Philippe, Svenja Riedesel, Martin Autzen, Dirk Mittelstrass, Harrison J. Gray, Jean-Michel Galharret.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer></div>

  


  

  </body></html>

