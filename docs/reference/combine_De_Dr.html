<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Combine Dose Rate and Equivalent Dose Distribution — combine_De_Dr • Luminescence</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Combine Dose Rate and Equivalent Dose Distribution — combine_De_Dr"><meta name="description" content="A Bayesian statistical analysis of OSL age requiring dose rate sample.
Estimation contains a preliminary step for detecting outliers in the equivalent
dose sample."><meta property="og:description" content="A Bayesian statistical analysis of OSL age requiring dose rate sample.
Estimation contains a preliminary step for detecting outliers in the equivalent
dose sample."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Luminescence</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.25</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">References</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-Lum/Luminescence"><span class="fa fa-github"></span> GitHub</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Combine Dose Rate and Equivalent Dose Distribution</h1>
      <small class="dont-index">Source: <a href="https://github.com/R-Lum/Luminescence/blob/HEAD/R/combine_De_Dr.R" class="external-link"><code>R/combine_De_Dr.R</code></a></small>
      <div class="d-none name"><code>combine_De_Dr.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A Bayesian statistical analysis of OSL age requiring dose rate sample.
Estimation contains a preliminary step for detecting outliers in the equivalent
dose sample.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">combine_De_Dr</span><span class="op">(</span></span>
<span>  <span class="va">De</span>,</span>
<span>  <span class="va">s</span>,</span>
<span>  <span class="va">Dr</span>,</span>
<span>  <span class="va">int_OD</span>,</span>
<span>  Age_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">300</span><span class="op">)</span>,</span>
<span>  outlier_threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  outlier_method <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  outlier_analysis_plot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  method_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  par_local <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-de">De<a class="anchor" aria-label="anchor" href="#arg-de"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<strong>required</strong>): a equivalent dose sample</p></dd>


<dt id="arg-s">s<a class="anchor" aria-label="anchor" href="#arg-s"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<strong>required</strong>): a vector of measurement errors on the equivalent dose</p></dd>


<dt id="arg-dr">Dr<a class="anchor" aria-label="anchor" href="#arg-dr"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<strong>required</strong>): a dose rate sample</p></dd>


<dt id="arg-int-od">int_OD<a class="anchor" aria-label="anchor" href="#arg-int-od"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<strong>required</strong>): the intrinsic overdispersion, typically the standard deviation
characterizing a dose-recovery test distribution</p></dd>


<dt id="arg-age-range">Age_range<a class="anchor" aria-label="anchor" href="#arg-age-range"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>): the age range to be investigated by the algorithm, the larger
the value the more iterations are needed and the longer it takes. Should not be set too narrow, cut
the algorithm some slack.</p></dd>


<dt id="arg-outlier-threshold">outlier_threshold<a class="anchor" aria-label="anchor" href="#arg-outlier-threshold"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>): the required significance level used
for the outlier detection. If set to <code>1</code>, no outliers are removed. If
<code>outlier_method = "RousseeuwCroux1993"</code>, the median distance is used as outlier threshold.
Please see details for further information.</p></dd>


<dt id="arg-outlier-method">outlier_method<a class="anchor" aria-label="anchor" href="#arg-outlier-method"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> (<em>with default</em>): select the outlier detection
method, either <code>"default"</code> or <code>"RousseeuwCroux1993"</code>. See details for further information.</p></dd>


<dt id="arg-outlier-analysis-plot">outlier_analysis_plot<a class="anchor" aria-label="anchor" href="#arg-outlier-analysis-plot"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): enables/disables the outlier analysis plot. Note: the outlier analysis will happen with or without plot output</p></dd>


<dt id="arg-method-control">method_control<a class="anchor" aria-label="anchor" href="#arg-method-control"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a> (<em>with default</em>): named <a href="https://rdrr.io/r/base/list.html" class="external-link">list</a> of further parameters passed down
to the <a href="https://rdrr.io/pkg/rjags/man/rjags-package.html" class="external-link">rjags::rjags</a> modelling</p></dd>


<dt id="arg-par-local">par_local<a class="anchor" aria-label="anchor" href="#arg-par-local"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): if set to <code>TRUE</code> the function uses its
own <a href="https://rdrr.io/r/graphics/par.html" class="external-link">graphics::par</a> settings (which will end in two plots next to each other)</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): enable/disable terminal feedback</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): enable/disable plot output</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>a few further arguments to fine-tune the plot output such as
<code>cdf_ADr_quantiles</code> (<code>TRUE</code>/<code>FALSE</code>), <code>legend.pos</code>, <code>legend</code> (<code>TRUE</code>/<code>FALSE</code>)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns a plot if <code>plot = TRUE</code> and an <a href="RLum.Results-class.html">RLum.Results</a>
object with the following slots:</p>
<p><code>@data</code><br><code>.. $Ages</code>: a <a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> vector with the modelled ages to be further analysed or visualised<br><code>.. $Ages_stats</code>: a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> with sum HPD, CI 68% and CI 95% for the ages <br><code>.. $outliers_index</code>: the index with the detected outliers<br><code>.. $cdf_ADr_mean</code> : empirical cumulative density distribution A * Dr (mean)<br><code>.. $cdf_ADr_quantiles</code> : empirical cumulative density distribution A * Dr (quantiles .025,.975)<br><code>.. $cdf_De_no_outlier</code> : empirical cumulative density distribution of the De with no outliers<br><code>.. $cdf_De_initial</code> : empirical cumulative density distribution of the initial De<br><code>.. $mcmc_IAM</code> : the MCMC list of the Individual Age Model, only of <code>method_control = list(return_mcmc = TRUE)</code> otherwise <code>NULL</code><br><code>.. $mcmc_BCAM</code> : the MCMC list of the Bayesian Central Age Model, only of <code>method_control = list(return_mcmc = TRUE)</code> otherwise <code>NULL</code><br></p>
<p><code>@info</code><br><code>.. $call</code>: the original function call<br><code>.. $model_IAM</code>: the BUGS model used to derive the individual age<br><code>.. $model_BCAM</code>: the BUGS model used to calculate the Bayesian Central Age<br></p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Outlier detection</strong></p>
<p>Two different outlier detection methods are implemented (full details are given
in the cited literature).</p><ol><li><p>The <em>default</em> and recommend method, uses quantiles to compare prior and
posterior distributions of the individual variances of the equivalent doses.
If the corresponding quantile in the corresponding posterior distribution is larger
than the quantile in the prior distribution, the value is marked
as outlier (cf. Galharret et al., preprint)</p></li>
<li><p>The alternative method employs the method suggested by Rousseeuw and Croux (1993)
using the absolute median distance.</p></li>
</ol><p><strong>Parameters available for <code>method_control</code></strong></p>
<p>The parameters listed below are used to granular control Bayesian modelling using
<a href="https://rdrr.io/pkg/rjags/man/rjags-package.html" class="external-link">rjags::rjags</a>. Internally the functions <code>.calc_IndividualAgeModel()</code> and
<code>.calc_BayesianCentraAgelModel()</code>. The parameter settings affect both models.
Note: <code>method_control</code> expects a <strong>named</strong> list of parameters</p>
<table class="table table"><tr><td><strong>PARAMETER</strong></td><td><strong>TYPE</strong></td><td><strong>DEFAULT</strong></td><td><strong>REMARKS</strong></td></tr><tr><td><code>variable.names_IAM</code></td><td><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></td><td><code>c('A', 'a', 'sig_a')</code></td><td>variables names to be monitored in the modelling process using the internal function <code>.calc_IndividualAgeModel()</code></td></tr><tr><td><code>variable.names_BCAM</code></td><td><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></td><td><code>c('A', 'D_e')</code></td><td>variables names to be monitored in the modelling process using the internal function <code>.calc_BayesianCentraAgelModel()</code></td></tr><tr><td><code>n.chains</code></td><td><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></td><td><code>4</code></td><td>number of MCMC chains</td></tr><tr><td><code>n.adapt</code></td><td><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></td><td><code>1000</code></td><td>number of iterations for the adaptation</td></tr><tr><td><code>n.iter</code></td><td><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></td><td><code>5000</code></td><td>number of iterations to monitor cf. <a href="https://rdrr.io/pkg/rjags/man/coda.samples.html" class="external-link">rjags::coda.samples</a></td></tr><tr><td><code>thin</code></td><td><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></td><td><code>1</code></td><td>thinning interval for the monitoring cf. <a href="https://rdrr.io/pkg/rjags/man/coda.samples.html" class="external-link">rjags::coda.samples</a></td></tr><tr><td><code>diag</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td><code>FALSE</code></td><td>additional terminal convergence diagnostic.
<code>FALSE</code> if <code>verbose = FALSE</code></td></tr><tr><td><code>progress.bar</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td><code>FALSE</code></td><td>enable/disable progress bar. <code>FALSE</code> if <code>verbose = FALSE</code></td></tr><tr><td><code>quiet</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td><code>TRUE</code></td><td>silence terminal output. Set to <code>TRUE</code> if <code>verbose = FALSE</code></td></tr><tr><td><code>return_mcmc</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td><code>FALSE</code></td><td>return additional MCMC diagnostic information</td></tr></table></div>
    <div class="section level2">
    <h2 id="function-version">Function version<a class="anchor" aria-label="anchor" href="#function-version"></a></h2>
    <p>0.1.0</p>
    </div>
    <div class="section level2">
    <h2 id="how-to-cite">How to cite<a class="anchor" aria-label="anchor" href="#how-to-cite"></a></h2>
    <p>Philippe, A., Galharret, J., Mercier, N., Kreutzer, S., 2024. combine_De_Dr(): Combine Dose Rate and Equivalent Dose Distribution. Function version 0.1.0. In: Kreutzer, S., Burow, C., Dietze, M., Fuchs, M.C., Schmidt, C., Fischer, M., Friedrich, J., Mercier, N., Philippe, A., Riedesel, S., Autzen, M., Mittelstrass, D., Gray, H.J., Galharret, J., Colombo, M., 2024. Luminescence: Comprehensive Luminescence Dating Data Analysis. R package version 0.9.25. https://r-lum.github.io/Luminescence/</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Mercier, N., Galharret, J.-M., Tribolo, C., Kreutzer, S., Philippe, A., preprint.
Luminescence age calculation through Bayesian convolution of equivalent dose and
dose-rate distributions: the De_Dr model. Geochronology, 1-22.</p>
<p>Galharret, J-M., Philippe, A., Mercier, N., preprint. Detection of outliers with
a Bayesian hierarchical model: application to the single-grain luminescence dating method.
Electronic Journal of Applied Statistics</p>
<p><strong>Further reading</strong></p>
<p>Rousseeuw, P.J., Croux, C., 1993. Alternatives to the median absolute deviation.
Journal of the American Statistical Association 88, 1273–1283. <a href="https://doi.org/10.2307/2291267" class="external-link">doi:10.2307/2291267</a></p>
<p>Rousseeuw, P.J., Debruyne, M., Engelen, S., Hubert, M., 2006. Robustness and outlier detection in chemometrics.
Critical Reviews in Analytical Chemistry 36, 221–242. <a href="https://doi.org/10.1080/10408340600969403" class="external-link">doi:10.1080/10408340600969403</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="plot_OSLAgeSummary.html">plot_OSLAgeSummary</a>, <a href="https://rdrr.io/pkg/rjags/man/rjags-package.html" class="external-link">rjags::rjags</a>, <a href="https://mclust-org.github.io/mclust/reference/mclust-package.html" class="external-link">mclust::mclust-package</a></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Anne Philippe, Université de Nantes (France),
Jean-Michel Galharret, Université de Nantes (France),
Norbert Mercier, IRAMAT-CRP2A, Université Bordeaux Montaigne (France),
Sebastian Kreutzer, Institute of Geography, Heidelberg University (Germany)
, RLum Developer Team</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## set parameters</span></span></span>
<span class="r-in"><span><span class="va">Dr</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span> <span class="op">(</span><span class="fl">1000</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">De</span> <span class="op">&lt;-</span> <span class="fl">50</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">Dr</span>, <span class="fl">50</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## run modelling</span></span></span>
<span class="r-in"><span><span class="co">## note: modify parameters for more realistic results</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">combine_De_Dr</span><span class="op">(</span></span></span>
<span class="r-in"><span> Dr <span class="op">=</span> <span class="va">Dr</span>,</span></span>
<span class="r-in"><span> int_OD <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span> <span class="va">De</span>,</span></span>
<span class="r-in"><span> <span class="va">s</span>,</span></span>
<span class="r-in"><span> Age_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> method_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  n.iter <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  n.chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## show models used</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">results</span><span class="op">@</span><span class="va">info</span><span class="op">$</span><span class="va">model_IAM</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">results</span><span class="op">@</span><span class="va">info</span><span class="op">$</span><span class="va">model_BCAM</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Kreutzer, Christoph Burow, Michael Dietze, Margret C. Fuchs, Christoph Schmidt, Manfred Fischer, Johannes Friedrich, Norbert Mercier, Anne Philippe, Svenja Riedesel, Martin Autzen, Dirk Mittelstrass, Harrison J. Gray, Jean-Michel Galharret, Marco Colombo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

