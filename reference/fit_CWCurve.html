<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Nonlinear Least Squares Fit for CW-OSL curves -beta version- — fit_CWCurve • Luminescence</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Nonlinear Least Squares Fit for CW-OSL curves -beta version- — fit_CWCurve"><meta name="description" content="The function determines the weighted least-squares estimates of the
component parameters of a CW-OSL signal for a given maximum number of
components and returns various component parameters. The fitting procedure
uses the nls function with the port algorithm.
Fitting function
The function for the CW-OSL fitting has the general form:
$$y = I0_{1}*\lambda_{1}*exp(-\lambda_1*x) + ,\ldots, + I0_{i}*\lambda_{i}*exp(-\lambda_i*x) $$
where \(0 &amp;lt; i &amp;lt; 8\)
and \(\lambda\) is the decay constant
and \(I0\) the initial number of trapped electrons.
(for the used equation cf. Boetter-Jensen et al., 2003, Eq. 2.31)
Start values
Start values are estimated automatically by fitting a linear function to the
logarithmized input data set. Currently, there is no option to manually
provide start parameters.
Goodness of fit
The goodness of the fit is given as pseudoR² value (pseudo coefficient of
determination). According to Lave (1970), the value is calculated as:
$$pseudoR^2 = 1 - RSS/TSS$$
where \(RSS = Residual~Sum~of~Squares\)
and \(TSS = Total~Sum~of~Squares\)
Error of fitted component parameters
The 1-sigma error for the
components is calculated using the function stats::confint. Due to
considerable calculation time, this option is deactivated by default. In
addition, the error for the components can be estimated by using internal R
functions like summary. See the nls help page
for more information.
For details on the nonlinear regression in R, see Ritz &amp;amp; Streibig (2008)."><meta property="og:description" content="The function determines the weighted least-squares estimates of the
component parameters of a CW-OSL signal for a given maximum number of
components and returns various component parameters. The fitting procedure
uses the nls function with the port algorithm.
Fitting function
The function for the CW-OSL fitting has the general form:
$$y = I0_{1}*\lambda_{1}*exp(-\lambda_1*x) + ,\ldots, + I0_{i}*\lambda_{i}*exp(-\lambda_i*x) $$
where \(0 &amp;lt; i &amp;lt; 8\)
and \(\lambda\) is the decay constant
and \(I0\) the initial number of trapped electrons.
(for the used equation cf. Boetter-Jensen et al., 2003, Eq. 2.31)
Start values
Start values are estimated automatically by fitting a linear function to the
logarithmized input data set. Currently, there is no option to manually
provide start parameters.
Goodness of fit
The goodness of the fit is given as pseudoR² value (pseudo coefficient of
determination). According to Lave (1970), the value is calculated as:
$$pseudoR^2 = 1 - RSS/TSS$$
where \(RSS = Residual~Sum~of~Squares\)
and \(TSS = Total~Sum~of~Squares\)
Error of fitted component parameters
The 1-sigma error for the
components is calculated using the function stats::confint. Due to
considerable calculation time, this option is deactivated by default. In
addition, the error for the components can be estimated by using internal R
functions like summary. See the nls help page
for more information.
For details on the nonlinear regression in R, see Ritz &amp;amp; Streibig (2008)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Luminescence</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">References</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-Lum/Luminescence"><span class="fa fa-github"></span> GitHub</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Nonlinear Least Squares Fit for CW-OSL curves -beta version-</h1>
      <small class="dont-index">Source: <a href="https://github.com/R-Lum/Luminescence/blob/v1.0.1/R/fit_CWCurve.R" class="external-link"><code>R/fit_CWCurve.R</code></a></small>
      <div class="d-none name"><code>fit_CWCurve.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function determines the weighted least-squares estimates of the
component parameters of a CW-OSL signal for a given maximum number of
components and returns various component parameters. The fitting procedure
uses the <a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a> function with the <code>port</code> algorithm.</p>
<p><strong>Fitting function</strong></p>
<p>The function for the CW-OSL fitting has the general form:</p>
<p>$$y = I0_{1}*\lambda_{1}*exp(-\lambda_1*x) + ,\ldots, + I0_{i}*\lambda_{i}*exp(-\lambda_i*x) $$</p>
<p>where \(0 &lt; i &lt; 8\)</p>
<p>and \(\lambda\) is the decay constant <br>
and \(I0\) the initial number of trapped electrons.</p>
<p><em>(for the used equation cf. Boetter-Jensen et al., 2003, Eq. 2.31)</em></p>
<p><strong>Start values</strong></p>
<p>Start values are estimated automatically by fitting a linear function to the
logarithmized input data set. Currently, there is no option to manually
provide start parameters.</p>
<p><strong>Goodness of fit</strong></p>
<p>The goodness of the fit is given as pseudoR² value (pseudo coefficient of
determination). According to Lave (1970), the value is calculated as:</p>
<p>$$pseudoR^2 = 1 - RSS/TSS$$</p>
<p>where \(RSS = Residual~Sum~of~Squares\) <br>
and \(TSS = Total~Sum~of~Squares\)</p>
<p><strong>Error of fitted component parameters</strong></p>
<p>The 1-sigma error for the
components is calculated using the function <a href="https://rdrr.io/r/stats/confint.html" class="external-link">stats::confint</a>. Due to
considerable calculation time, this option is deactivated by default. In
addition, the error for the components can be estimated by using internal R
functions like <a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a>. See the <a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a> help page
for more information.</p>
<p><em>For details on the nonlinear regression in R, see Ritz &amp; Streibig (2008).</em></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_CWCurve</span><span class="op">(</span></span>
<span>  <span class="va">values</span>,</span>
<span>  <span class="va">n.components.max</span>,</span>
<span>  fit.failure_threshold <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  fit.method <span class="op">=</span> <span class="st">"port"</span>,</span>
<span>  fit.trace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fit.calcError <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  LED.power <span class="op">=</span> <span class="fl">36</span>,</span>
<span>  LED.wavelength <span class="op">=</span> <span class="fl">470</span>,</span>
<span>  cex.global <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  sample_code <span class="op">=</span> <span class="st">"Default"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output.terminalAdvanced <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-values">values<a class="anchor" aria-label="anchor" href="#arg-values"></a></dt>
<dd><p><a href="RLum.Data.Curve-class.html">RLum.Data.Curve</a> or <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> (<strong>required</strong>):
x, y data of measured values (time and counts). See examples.</p></dd>


<dt id="arg-n-components-max">n.components.max<a class="anchor" aria-label="anchor" href="#arg-n-components-max"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a> (<em>optional</em>):
maximum number of components that are to be used for fitting.
The upper limit is 7.</p></dd>


<dt id="arg-fit-failure-threshold">fit.failure_threshold<a class="anchor" aria-label="anchor" href="#arg-fit-failure-threshold"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a> (<em>with default</em>):
limits the failed fitting attempts.</p></dd>


<dt id="arg-fit-method">fit.method<a class="anchor" aria-label="anchor" href="#arg-fit-method"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> (<em>with default</em>):
select fit method, allowed values: <code>'port'</code> and <code>'LM'</code>. <code>'port'</code> uses the 'port'
routine from the function <a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a> <code>'LM'</code> utilises the function <code>nlsLM</code> from
the package <code>minpack.lm</code> and with that the Levenberg-Marquardt algorithm.</p></dd>


<dt id="arg-fit-trace">fit.trace<a class="anchor" aria-label="anchor" href="#arg-fit-trace"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
traces the fitting process on the terminal.</p></dd>


<dt id="arg-fit-calcerror">fit.calcError<a class="anchor" aria-label="anchor" href="#arg-fit-calcerror"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
calculate 1-sigma error range of components using <a href="https://rdrr.io/r/stats/confint.html" class="external-link">stats::confint</a></p></dd>


<dt id="arg-led-power">LED.power<a class="anchor" aria-label="anchor" href="#arg-led-power"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>):
LED power (max.) used for intensity ramping in mW/cm².
<strong>Note:</strong> The value is used for the calculation of the absolute
photoionisation cross section.</p></dd>


<dt id="arg-led-wavelength">LED.wavelength<a class="anchor" aria-label="anchor" href="#arg-led-wavelength"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>):
LED wavelength used for stimulation in nm.
<strong>Note:</strong> The value is used for the calculation of the absolute
photoionisation cross section.</p></dd>


<dt id="arg-cex-global">cex.global<a class="anchor" aria-label="anchor" href="#arg-cex-global"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>):
global scaling factor.</p></dd>


<dt id="arg-sample-code">sample_code<a class="anchor" aria-label="anchor" href="#arg-sample-code"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> (<em>optional</em>):
sample code used for the plot and the optional output table (<code>mtext</code>).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
enable/disable output to the terminal.</p></dd>


<dt id="arg-output-terminaladvanced">output.terminalAdvanced<a class="anchor" aria-label="anchor" href="#arg-output-terminaladvanced"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
enhanced terminal output. Only valid if <code>verbose = TRUE</code>.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>):
enable/disable the plot output.</p></dd>


<dt id="arg-method-control">method_control<a class="anchor" aria-label="anchor" href="#arg-method-control"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a> (<em>optional</em>): options to control the output
produced. Currently only the 'export.comp.contrib.matrix' (logical) option
is supported, to enable/disable export of the component contribution
matrix.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>further arguments and graphical parameters passed to <a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><strong>plot (<em>optional</em>)</strong></p>
<p>the fitted CW-OSL curves are returned as plot.</p>
<p><strong>RLum.Results object</strong></p>
<p>Beside the plot and table output options, an <a href="RLum.Results-class.html">RLum.Results</a> object is
returned.</p>
<p><code>fit</code>:
an <code>nls</code> object (<code>$fit</code>) for which generic R functions are
provided, e.g. <a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a>, <a href="https://rdrr.io/r/stats/confint.html" class="external-link">stats::confint</a>, <a href="https://rdrr.io/r/stats/profile.html" class="external-link">profile</a>. For more
details, see <a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a>.</p>
<p><code>output.table</code>:
a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> containing the summarised parameters including the error</p>
<p><code>component.contribution.matrix</code>:
<a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a> containing the values for the component to sum contribution plot
(<code>$component.contribution.matrix</code>).
Produced only if <code>method_control$export.comp.contrib.matrix = TRUE</code>).</p>
<p>Matrix structure:<br>
Column 1 and 2: time and <code>rev(time)</code> values <br>
Additional columns are used for the components, two for each component,
containing I0 and n0. The last columns <code>cont.</code> provide information on
the relative component contribution for each time interval including the row
sum for this values.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p><strong>Beta version - This function has not been properly tested yet and</strong>
<strong>should therefore not be used for publication purposes!</strong></p>
<p>The pseudo-R² may not be the best parameter to describe the goodness of the
fit. The trade off between the <code>n.components</code> and the pseudo-R² value
is currently not considered.</p>
<p>The function <strong>does not</strong> ensure that the fitting procedure has reached a
global minimum rather than a local minimum!</p>
    </div>
    <div class="section level2">
    <h2 id="function-version">Function version<a class="anchor" aria-label="anchor" href="#function-version"></a></h2>
    <p>0.5.4</p>
    </div>
    <div class="section level2">
    <h2 id="how-to-cite">How to cite<a class="anchor" aria-label="anchor" href="#how-to-cite"></a></h2>
    <p>Kreutzer, S., 2025. fit_CWCurve(): Nonlinear Least Squares Fit for CW-OSL curves -beta version-. Function version 0.5.4. In: Kreutzer, S., Burow, C., Dietze, M., Fuchs, M.C., Schmidt, C., Fischer, M., Friedrich, J., Mercier, N., Philippe, A., Riedesel, S., Autzen, M., Mittelstrass, D., Gray, H.J., Galharret, J., Colombo, M., Steinbuch, L., Boer, A.d., 2025. Luminescence: Comprehensive Luminescence Dating Data Analysis. R package version 1.0.1. https://r-lum.github.io/Luminescence/</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Boetter-Jensen, L., McKeever, S.W.S., Wintle, A.G., 2003.
Optically Stimulated Luminescence Dosimetry. Elsevier Science B.V.</p>
<p>Lave, C.A.T., 1970. The Demand for Urban Mass Transportation. The Review of
Economics and Statistics, 52 (3), 320-323.</p>
<p>Ritz, C. &amp; Streibig, J.C., 2008. Nonlinear Regression with R. In: R.
Gentleman, K. Hornik, G. Parmigiani, eds., Springer, p. 150.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="fit_LMCurve.html">fit_LMCurve</a>, <a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a>,<a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a>, <a href="RLum.Data.Curve-class.html">RLum.Data.Curve</a>,
<a href="RLum.Results-class.html">RLum.Results</a>, <a href="get_RLum.html">get_RLum</a>, <a href="https://rdrr.io/pkg/minpack.lm/man/nlsLM.html" class="external-link">minpack.lm::nlsLM</a></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Kreutzer, Institute of Geography, Heidelberg University (Germany)
, RLum Developer Team</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##load data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ExampleData.CW_OSL_Curve</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##fit data</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">fit_CWCurve</span><span class="op">(</span>values <span class="op">=</span> <span class="va">ExampleData.CW_OSL_Curve</span>,</span></span>
<span class="r-in"><span>                   main <span class="op">=</span> <span class="st">"CW Curve Fit"</span>,</span></span>
<span class="r-in"><span>                   n.components.max <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                   log <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [fit_CWCurve()]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitting was finally done using a 3-component function (max=4):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y ~ I0.1 * lambda.1 * exp(-lambda.1 * x) + I0.2 * lambda.2 * exp(-lambda.2 * x) + I0.3 * lambda.3 * exp(-lambda.3 * x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          I0 I0.error     lambda lambda.error           cs cs.rel</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c1 2387.620       NA 4.59053773           NA 5.389394e-17 1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c2 1053.489       NA 1.95936140           NA 2.300334e-17 0.4268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c3 2816.631       NA 0.02054732           NA 2.412301e-19 0.0045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pseudo-R^2 = 0.9995</span>
<span class="r-plt img"><img src="fit_CWCurve-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Kreutzer, Christoph Burow, Michael Dietze, Margret C. Fuchs, Christoph Schmidt, Manfred Fischer, Johannes Friedrich, Norbert Mercier, Anne Philippe, Svenja Riedesel, Martin Autzen, Dirk Mittelstrass, Harrison J. Gray, Jean-Michel Galharret, Marco Colombo, Luc Steinbuch, Anna-Maartje de Boer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

