<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fitting and Deconvolution of OSL Lifetime Components — fit_OSLLifeTimes • Luminescence</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting and Deconvolution of OSL Lifetime Components — fit_OSLLifeTimes"><meta name="description" content="Fitting and Deconvolution of OSL Lifetime Components"><meta property="og:description" content="Fitting and Deconvolution of OSL Lifetime Components"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Luminescence</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">References</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-Lum/Luminescence"><span class="fa fa-github"></span> GitHub</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting and Deconvolution of OSL Lifetime Components</h1>
      <small class="dont-index">Source: <a href="https://github.com/R-Lum/Luminescence/blob/v1.1.1/R/fit_OSLLifeTimes.R" class="external-link"><code>R/fit_OSLLifeTimes.R</code></a></small>
      <div class="d-none name"><code>fit_OSLLifeTimes.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fitting and Deconvolution of OSL Lifetime Components</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_OSLLifeTimes</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  tp <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  signal_range <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n.components <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_simple <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p><a href="RLum.Data.Curve-class.html">RLum.Data.Curve</a>, <a href="RLum.Analysis-class.html">RLum.Analysis</a>, <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> or <a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a> (<strong>required</strong>):
Input object containing the data to be analysed. All objects can be provided also as list for an automated
processing. Please note: <code>NA</code> values are automatically removed and the dataset should comprise at least 5 data points (possibly more if <code>n.components</code> is
set to a value greater than 1)</p></dd>


<dt id="arg-tp">tp<a class="anchor" aria-label="anchor" href="#arg-tp"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>): option to account for the stimulation pulse width. For off-time measurements
the default value is 0. <code>tp</code> has the same unit as the measurement data, e.g., µs. Please set this parameter
carefully, if it all, otherwise you may heavily bias your fit results.</p></dd>


<dt id="arg-signal-range">signal_range<a class="anchor" aria-label="anchor" href="#arg-signal-range"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>optional</em>): allows to set a channel range, by default all channels are used, e.g.
<code>signal_range = c(2,100)</code> considers only channels 2 to 100 and <code>signal_range = c(2)</code> considers only channels
from channel 2 onwards.</p></dd>


<dt id="arg-n-components">n.components<a class="anchor" aria-label="anchor" href="#arg-n-components"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>optional</em>): Fix the number of components. If set the algorithm will try
to fit the number of predefined components. If nothing is set, the algorithm will try to find the best number
of components.</p></dd>


<dt id="arg-method-control">method_control<a class="anchor" aria-label="anchor" href="#arg-method-control"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a> (<em>optional</em>): Named to allow a more fine control of the fitting process. See details
for allowed options.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): Enable/disable the plot output.</p></dd>


<dt id="arg-plot-simple">plot_simple<a class="anchor" aria-label="anchor" href="#arg-plot-simple"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): Enable/disable the reduced
plot output. If <code>TRUE</code>, no
residual plot is shown, however, plot output can be combined using the standard R layout options,
such as <code>par(mfrow = c(2,2))</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): Enable/disable output to the
terminal.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>parameters passed to <a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot.default</a> to control the plot output, supported are:
<code>main</code>, <code>xlab</code>, <code>ylab</code>, <code>log</code>, <code>xlim</code>, <code>ylim</code>, <code>col</code>, <code>lty</code>, <code>legend.pos</code>, <code>legend.text</code>. If the input
object is of type <a href="RLum.Analysis-class.html">RLum.Analysis</a> this arguments can be provided as a <a href="https://rdrr.io/r/base/list.html" class="external-link">list</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>———————————–<br><code>[ NUMERICAL OUTPUT ]</code><br>
———————————–<br></p>
<p><strong><code>RLum.Results</code></strong>-object</p>
<p><strong>slot:</strong> <strong><code>@data</code></strong></p>
<table class="table table"><tr><td><strong>Element</strong></td><td><strong>Type</strong></td><td><strong>Description</strong></td></tr><tr><td><code>$data</code></td><td><code>matrix</code></td><td>the final fit matrix</td></tr><tr><td><code>$start_matrix</code></td><td><code>matrix</code></td><td>the start matrix used for the fitting</td></tr><tr><td><code>$total_counts</code></td><td><code>integer</code></td><td>Photon count sum</td></tr><tr><td><code>$fit</code></td><td><code>nls</code></td><td>the fit object returned by <a href="https://rdrr.io/pkg/minpack.lm/man/nls.lm.html" class="external-link">minpack.lm::nls.lm</a></td></tr></table><p><strong>slot:</strong> <strong><code>@info</code></strong></p>
<p>The original function call</p>
<p>————————<br><code>[ TERMINAL OUTPUT ]</code><br>
————————<br></p>
<p>Terminal output is only shown of the argument <code>verbose = TRUE</code>.</p>
<p><em>(1) Start parameter and component adaption</em><br>
Trave of the parameter adaptation process</p>
<p><em>(2) Fitting results (sorted by ascending tau)</em><br>
The fitting results sorted by ascending tau value. Please note
that if you access the <code>nls</code> fitting object, the values are not sorted.</p>
<p><em>(3) Further information</em><br></p><ul><li><p>The photon count sum</p></li>
<li><p>Durbin-Watson residual statistic to assess whether the residuals are correlated, ideally
the residuals should be not correlated at all. Rough measures are: <br>
D = 0: the residuals are systematically correlated <br>
D = 2: the residuals are randomly distributed <br>
D = 4: the residuals are systematically anti-correlated<br></p></li>
</ul><p>You should be suspicious if D differs largely from 2.</p>
<p>————————<br><code>[ PLOT OUTPUT ]</code><br>
————————<br></p>
<p>A plot showing the original data and the fit so far possible. The lower plot shows the
residuals of the fit.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function intends to provide an easy access to pulsed optically stimulated luminescence (POSL) data,
in order determine signal lifetimes. The fitting is currently optimised to work with the off-time flank of POSL measurements
only. For the signal deconvolution, a differential evolution optimisation is combined with nonlinear least-square fitting
following the approach by Bluszcz &amp; Adamiec (2006).</p>
<p><strong>Component deconvolution algorithm</strong></p>
<p>The component deconvolution consists of two steps:</p>
<p>(1) Adaptation phase</p>
<p>In the adaptation phase the function tries to figure out the optimal and statistically justified
number of signal components following roughly the approach suggested by Bluszcz &amp; Adamiec (2006). In
contrast to their work, for the optimisation by differential evolution here the package <code>'DEoptim'</code> is used.</p>
<p>The function to be optimized has the form:</p>
<p>$$\chi^2 = \sum(w * (n_i/c - \sum(A_i * exp(-x/(tau_i + t_p))))^2)$$</p>
<p>with \(w = 1\) for unweighted regression analysis (<code>method_control = list(weights = FALSE)</code>) or
\(w = c^2/n_i\) for weighted regression analysis. The default values is <code>TRUE</code>.</p>
<p>$$F = (\Delta\chi^2 / 2) / (\chi^2/(N - 2*m - 2))$$</p>
<p>(2) Final fitting</p>
<p><strong><code>method_control</code></strong></p>
<table class="table table"><tr><td><strong>Parameter</strong></td><td><strong>Type</strong></td><td><strong>Description</strong></td></tr><tr><td><code>p</code></td><td><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></td><td>controls the probability for the F statistic reference values. For a significance level of 5 % a value of 0.95 (the default) should be added, for 1 %, a value of 0.99 is sufficient: 1 &gt; p &gt; 0 (cf. stats::FDist)</td></tr><tr><td><code>seed</code></td><td><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></td><td>set the seed for the random number generator, provide a value here to get reproducible results</td></tr><tr><td><code>DEoptim.trace</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td>enable/disable the tracing of the differential evolution (cf. <a href="https://rdrr.io/pkg/DEoptim/man/DEoptim.control.html" class="external-link">DEoptim::DEoptim.control</a>)</td></tr><tr><td><code>DEoptim.itermax</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td>control the number of the allowed generations (cf. <a href="https://rdrr.io/pkg/DEoptim/man/DEoptim.control.html" class="external-link">DEoptim::DEoptim.control</a>)</td></tr><tr><td><code>weights</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td>enable/disable the weighting for the start parameter estimation and fitting (see equations above).
The default values is <code>TRUE</code></td></tr><tr><td><code>nlsLM.trace</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td>enable/disable trace mode for the nls fitting (<a href="https://rdrr.io/pkg/minpack.lm/man/nlsLM.html" class="external-link">minpack.lm::nlsLM</a>), can be used to identify convergence problems, default is <code>FALSE</code></td></tr><tr><td><code>nlsLM.upper</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td>enable/disable upper parameter boundary, default is <code>TRUE</code></td></tr><tr><td><code>nlsLM.lower</code></td><td><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></td><td>enable/disable lower parameter boundary, default is <code>TRUE</code></td></tr></table></div>
    <div class="section level2">
    <h2 id="function-version">Function version<a class="anchor" aria-label="anchor" href="#function-version"></a></h2>
    <p>0.1.5</p>
    </div>
    <div class="section level2">
    <h2 id="how-to-cite">How to cite<a class="anchor" aria-label="anchor" href="#how-to-cite"></a></h2>
    <p>Kreutzer, S., Schmidt, C., 2025. fit_OSLLifeTimes(): Fitting and Deconvolution of OSL Lifetime Components. Function version 0.1.5. In: Kreutzer, S., Burow, C., Dietze, M., Fuchs, M.C., Schmidt, C., Fischer, M., Friedrich, J., Mercier, N., Philippe, A., Riedesel, S., Autzen, M., Mittelstrass, D., Gray, H.J., Galharret, J., Colombo, M., Steinbuch, L., Boer, A.d., 2025. Luminescence: Comprehensive Luminescence Dating Data Analysis. R package version 1.1.1. https://r-lum.github.io/Luminescence/</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bluszcz, A., Adamiec, G., 2006. Application of differential evolution to fitting OSL decay curves.
Radiation Measurements 41, 886-891. <a href="https://doi.org/10.1016/j.radmeas.2006.05.016" class="external-link">doi:10.1016/j.radmeas.2006.05.016</a>
<br></p>
<p>Durbin, J., Watson, G.S., 1950. Testing for Serial Correlation in Least Squares Regression: I.
Biometrika 37, 409-21. doi:10.2307/2332391</p>
<p><strong>Further reading</strong></p>
<p>Hughes, I., Hase, T., 2010. Measurements and Their Uncertainties. Oxford University Press.</p>
<p>Storn, R., Price, K., 1997. Differential Evolution –
A Simple and Efficient Heuristic for Global Optimization over Continuous Spaces.
Journal of Global Optimization 11, 341–359.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="https://rdrr.io/pkg/minpack.lm/man/nls.lm.html" class="external-link">minpack.lm::nls.lm</a>, <a href="https://rdrr.io/pkg/DEoptim/man/DEoptim.html" class="external-link">DEoptim::DEoptim</a></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Kreutzer, Geography &amp; Earth Sciences, Aberystwyth University,
Christoph Schmidt, University of Bayreuth (Germany)
, RLum Developer Team</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##load example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ExampleData.TR_OSL</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##fit lifetimes (short run)</span></span></span>
<span class="r-in"><span><span class="fu">fit_OSLLifeTimes</span><span class="op">(</span></span></span>
<span class="r-in"><span> object <span class="op">=</span> <span class="va">ExampleData.TR_OSL</span>,</span></span>
<span class="r-in"><span> n.components <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [fit_OSLLifeTime()]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (1) Start parameter and component adapation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------(start adaption)------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt;&gt; + adaption for 1 comp. :  Inf (calc.) &lt;&gt;  3 (ref.) &gt;&gt; [add comp.] &gt;&gt; [forced stop]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------(end adaption)--------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt;&gt; Applied component matrix</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   A     tau</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Comp.1 2.118737e+12 87.9146</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (2) Fitting results (sorted by ascending tau)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Estimate   Std. Error   t value      Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A.1   2.118737e+10 9.710554e+07 218.18915  0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> tau.1 8.791461e+01 3.167935e+00  27.75139 1.196538e-143</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (3) Further information</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Photon count sum:  3.831e+13 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Durbin-Watson residual statistic:  0.77 [ &lt;&gt;        ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-plt img"><img src="fit_OSLLifeTimes-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [RLum.Results-class]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	 originator: fit_OSLLifeTimes()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	 data: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  	 .. $data : matrix</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	 .. $start_matrix : matrix</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	 .. $total_counts : numeric</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	 .. $fit : nls</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	 additional info elements:  1 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##long example</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu">fit_OSLLifeTimes</span><span class="op">(</span></span></span>
<span class="r-in"><span>object <span class="op">=</span> <span class="va">ExampleData.TR_OSL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Kreutzer, Christoph Burow, Michael Dietze, Margret C. Fuchs, Christoph Schmidt, Manfred Fischer, Johannes Friedrich, Norbert Mercier, Anne Philippe, Svenja Riedesel, Martin Autzen, Dirk Mittelstrass, Harrison J. Gray, Jean-Michel Galharret, Marco Colombo, Luc Steinbuch, Anna-Maartje de Boer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

