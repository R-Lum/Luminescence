<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Moran's I — calc_MoransI • Luminescence</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Moran's I — calc_MoransI"><meta name="description" content="Calculate Moran's I"><meta property="og:description" content="Calculate Moran's I"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Luminescence</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">References</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-Lum/Luminescence"><span class="fa fa-github"></span> GitHub</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Moran's I</h1>
      <small class="dont-index">Source: <a href="https://github.com/R-Lum/Luminescence/blob/master/R/calc_MoransI.R" class="external-link"><code>R/calc_MoransI.R</code></a></small>
      <div class="d-none name"><code>calc_MoransI.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate Moran's I</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_MoransI</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  df_neighbours <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spatial_autocorrelation <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  compute_pseudo_p <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tested_moransI <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_permutations <span class="op">=</span> <span class="fl">999</span>,</span>
<span>  ignore_borders <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_intermediate_values <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p><a href="RLum.Results-class.html">RLum.Results</a> or <a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<strong>required</strong>) containing
the values of the grains of one. Should have length 100; can contain <code>NA</code>
values.</p></dd>


<dt id="arg-df-neighbours">df_neighbours<a class="anchor" aria-label="anchor" href="#arg-df-neighbours"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> (<em>with default</em>): a data frame with 3
columns (<code>location</code>, <code>neighbour</code> and <code>weight</code>, respectively), with each row
indicating the index of one location and one of its neighbours (note that
the concept of "location" versus "neighbour" is symmetric, so each
neighbouring pair needs to be specified only once), alongside their relative
weight (generally set to 1). If <code>NULL</code> (default), this is constructed
automatically by the internal function <code>.get_Neighbours</code>.</p></dd>


<dt id="arg-spatial-autocorrelation">spatial_autocorrelation<a class="anchor" aria-label="anchor" href="#arg-spatial-autocorrelation"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): whether spatial
autocorrelation should be considered in the computation of Moran's I
(<code>TRUE</code> by default). If <code>FALSE</code>, the function computes Moran's I expected
value in case of no autocorrelation (H_0). See details for further
information.</p></dd>


<dt id="arg-compute-pseudo-p">compute_pseudo_p<a class="anchor" aria-label="anchor" href="#arg-compute-pseudo-p"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): whether a pseudo p-value
should be computed (<code>FALSE</code> by default).</p></dd>


<dt id="arg-tested-moransi">tested_moransI<a class="anchor" aria-label="anchor" href="#arg-tested-moransi"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a> (<em>with default</em>): The value of Moran's I to
be tested against when computing the pseudo p-value. If <code>NULL</code> (default), the
value calculated by the function will be used. Ignored if <code>compute_pseudo_p</code>
is <code>FALSE</code>.</p></dd>


<dt id="arg-n-permutations">n_permutations<a class="anchor" aria-label="anchor" href="#arg-n-permutations"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a> (<em>with default</em>): number of random
permutations tested to calculate the fraction which is the pseudo p
(defaults to 999). Influences the calculation speed, which will have
impact in case of large scale simulation loops. Ignored if <code>compute_pseudo_p</code>
is <code>FALSE</code>.</p></dd>


<dt id="arg-ignore-borders">ignore_borders<a class="anchor" aria-label="anchor" href="#arg-ignore-borders"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): whether only grain
locations that do not lie on the border of the disc should be considered
(<code>FALSE</code> by default). Thus if <code>TRUE</code>, only the inner 8x8 grain locations
rather than the full 10x10 are considered. Ignored if <code>df_neighbours</code> is
not <code>NULL</code> or if <code>spatial_autocorrelation = FALSE</code>.</p></dd>


<dt id="arg-return-intermediate-values">return_intermediate_values<a class="anchor" aria-label="anchor" href="#arg-return-intermediate-values"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a> (<em>with default</em>): whether the
function should return a list with several intermediate calculation results
(defaults to <code>FALSE</code>). Ignored if <code>spatial_autocorrelation</code> is <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>By default one numerical value, roughly between -1 and 1, where
close to zero means no spatial correlation, and value close to 1 a positive
spatial correlation given the pattern we interested in (by default all rook
neighbours). A value closer to -1 has no meaning within the context of
luminescence crosstalk. If <code>compute_pseudo_p = TRUE</code>, then the computed
pseudo p-value is returned. If <code>return_intermediate_values</code> is set to <code>TRUE</code>,
a list with several values used for calculation is returned instead of a
single outcome.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Case of no spatial autocorrelation</strong></p>
<p>Perhaps a bit counter-intuitive, the expected value of Moran's I under the
null hypothesis of no spatial correlation is a value slightly smaller than
zero. When setting <code>spatial_autocorrelation = FALSE</code>, this function
calculates the expected value based on the number of observations or the
length of the observation vector (while taking out <code>NA</code> values). Note that
the expected value only depends on the number of observed separate grain
values. This can be useful for plotting.</p>
<p>The expected Moran's I for the null hypothesis of no spatial correlation
corresponds to <code>-1 / (n - 1)</code>, with <code>n</code> being the number of non-missing
observations.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>de Boer, A-M., Steinbuch, L., Heuvelink, G.B.M., Wallinga, J., 2025.
A novel tool to assess crosstalk in single-grain luminescence detection.
Submitted.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Anna-Maartje de Boer, Luc Steinbuch, Wageningen University &amp; Research, 2025</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Test a fictional sample with spatial correlation</span></span></span>
<span class="r-in"><span><span class="fu">calc_MoransI</span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.8888889</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Test some fictional samples without spatial correlation;</span></span></span>
<span class="r-in"><span><span class="co">## note the randomness with each repetition</span></span></span>
<span class="r-in"><span><span class="fu">calc_MoransI</span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -0.06706568</span>
<span class="r-in"><span><span class="fu">calc_MoransI</span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.01886048</span>
<span class="r-in"><span><span class="fu">calc_MoransI</span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.06968043</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Kreutzer, Christoph Burow, Michael Dietze, Margret C. Fuchs, Christoph Schmidt, Manfred Fischer, Johannes Friedrich, Norbert Mercier, Anne Philippe, Svenja Riedesel, Martin Autzen, Dirk Mittelstrass, Harrison J. Gray, Jean-Michel Galharret, Marco Colombo, Luc Steinbuch, Anna-Maartje de Boer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

