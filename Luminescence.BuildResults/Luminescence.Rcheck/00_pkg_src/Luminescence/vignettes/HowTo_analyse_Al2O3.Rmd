---
title: "How to Analyse Al2O3:C Measurements"
author: "Sebastian Kreutzer, IRAMAT-CRP2A, UMR 5060, CNRS - Université Bordeaux Montagine, France"
date: "Last modified: `r Sys.Date()` ('Luminescence' version: `r packageVersion('Luminescence')`)"
output: 
  rmarkdown::html_vignette:
    fig_caption: yes
    number_sections: yes
    toc: yes
vignette: >
  %\VignetteEncoding{UTF-8}
---

# Scope
The package 'Luminescence' offers three distinct functions dealing with the analysis of Al$_{2}$O$_{3}$:C chip measurements:

1. `analyse_Al2O3C_ITC()`
2. `analyse_Al2O3C_CrossTalk()`
3. `analyse_Al2O3C_Measurement()`

Only the last function is usually needed to routinely estimate the (environmental $\gamma$-) dose the chip had received. However, the first two functions are needed to correct for equipment related issues. If you have already performed the first two analyses or you do not feel the need for them, you can directly start with the Sec. [4](#Al2O3_Dose_Determination).

The following tutorial assumes that all measurements have been performed on a Freiberg Instruments *lexsyg SMART* luminescence reader (Richter et al., 2015). Nevertheless, the general procedure should also work for other luminescence readers. However, please keep in mind that for readers without a separate measurement chamber the determination 
of the irradiation cross-talk becomes indispensable and should not be skipped.  

Please further note that this vignette covers only the **R** related part of the data analysis and will 
not explain the theoretical and physical background. Please see Kreutzer et al. (2018), for details. 

# Determine irradiation time correction factors

## Data import
```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
library(Luminescence)
temp <- read_XSYG2R("~/Lumi/Bordeaux/Al2O3_Test/XSYG/Manuscript/2017-03-22_20170302_Al2O3_MDL.xsyg", fastForward = TRUE, txtProgressBar = FALSE)
data_ITC <- temp[[1]]

temp_CT <- read_XSYG2R("~/Lumi/Bordeaux/Al2O3_Test/XSYG/Manuscript/", fastForward = TRUE, pattern = "CrossTalk_NEW",
  txtProgressBar = FALSE)
data_CT <- temp_CT

temp_CAL <- read_XSYG2R("~/Lumi/Bordeaux/Al2O3_Test/XSYG/Manuscript/", fastForward = TRUE, pattern = "Calibration",
  txtProgressBar = FALSE)
data_EnvD <- temp_CAL
temp_CAL_info <- read_XSYG2R("~/Lumi/Bordeaux/Al2O3_Test/XSYG/Manuscript/", import = FALSE, pattern = "Calibration")
```

To determine the irradiation time correction factor the function `analyse_Al2O3C_ITC()` is used. The measurement 
sequence is based on the suggestions made by Kreutzer et al. (2018). To import the measurement data run the function 
`read_XSYG2R()`. The curve selection is done automatically by the function using the argument `recordType` (preset). 
Modify this argument if the selection here does not fit your equipment. 

```{r,eval = FALSE}
library(Luminescence)
data_ITC <- read_XSYG2R("MyIrradiationTimeCorrectionMeasurement.XSYG", fastForward = TRUE)
data_ITC
```

```{r, echo=FALSE, R.options=list(width = 10)}
cat(paste(c(capture.output(data_ITC)[1:10], "... <remaining records truncated manually>"), collapse = "\n"))
```

## Run analysis

The imported data are either a single `RLum.Analysis` object or a `list` of such objects, which can 
be directly passed to the function `analyse_Al2O3C_ITC()`. 

*Please note that if you follow the suggestions by Kreutzer et al. (in press) no further function arguments are necessary.*

\newline{}

```{r Fig1, fig.cap="Dose response curve used to correct the irradiation time for the movement duration of the sample carrier.", out.width=".8\\linewidth", fig.align="center", dpi=75}
results_ITC <- analyse_Al2O3C_ITC(object = data_ITC)
```

The analysis returns a plot (Fig.\ref{fig:Fig1}) and the output is stored in the object `results_ITC` and will be used later.  
\clearpage{}

# Irradiation cross-talk estimation

## Data import

The data import is similar to the data import given above (including the automatic curve selection).

```{r,eval = FALSE}
library(Luminescence)
data_CT <- read_XSYG2R("MyCrossTalkIrradiationMeasurement.XSYG", fastForward = TRUE)
data_CT
```

```{r, echo=FALSE, R.options=list(width = 10)}
data_CT[[1]]
```

## Data analysis

For the data analysis the function `analyse_Al2O3C_CrossTalk()` is called. Amongst others, the function 
has a parameter called `irradiation_time_correction`. This parameter can be left empty **or** the 
results from the previous irradiation time correction measurements can be directly passed to the 
function. Graphical results are shown in Fig.$~$\ref{fig:Fig2}. The numerical output is again 
an `RLum.Results` object which can be kept for a later usage, i.e. for an automatic correction during 
the dose estimation.

```{r, Fig2, fig.cap="Graphical function output of the crosstalk data analysis. Please note that the plot shows the results from repeated cross-talk measurements as described by Kreutzer et al. (2018).", fig.align="center", fig.height=6.5, fig.width=8, fig.pos="h", out.height="400px", out.width="500px", dpi=75}
results_CT <- analyse_Al2O3C_CrossTalk(
  object = data_CT,
  irradiation_time_correction = results_ITC)
```

\clearpage{}

# Al$_{2}$O$_{3}$:C dose determination {#Al2O3_Dose_Determination}

This section describes the workflow for the final apparent dose estimation of an Al$_{2}$O$_{3}$ chip. 
The analyses done above are not necessary but recommended to correct for the equipment characteristics. 

## Data import

The data import follows the examples given below and consists of calling the function `read_XSYG2R()`. 
An additional curve selection is not necessary, so far the sequence follows the suggestion by Kreutzer et al. (2018)

```{r,eval = FALSE}
library(Luminescence)
data_EnvD <- read_XSYG2R("MyEnvironmentalDoseMeasurement.XSYG", fastForward = TRUE)
data_EnvD
```

## Data analysis

For the analysis of the environmental dose the Al$_{2}$O$_{3}$ chips received, the results from the estimation 
of the irradiation time correction analysis and the cross-talk measurements are provided as input 
objects. The function automatically corrects for both effects. If this is not wanted the arguments 
can be set to `NULL` (the default)

```{r, eval = FALSE, echo = TRUE, fig.height = 4, fig.width=8, fig.align="center", dpi=75}
results_EnvD <- analyse_Al2O3C_Measurement(
  object = data_EnvD, 
  irradiation_time_correction = results_ITC, 
  cross_talk_correction = results_CT)
```

```{r, echo = FALSE, fig.height = 4, fig.width=8, fig.align="center", fig.cap="Representive curve plots for one chip. Shown are OSL and TL curves.", dpi=75}
analyse_Al2O3C_Measurement(
  object = data_EnvD[[2]], 
  irradiation_time_correction = results_ITC, 
  cross_talk_correction = results_CT)
```

```{r, echo = FALSE}
results_EnvD <- analyse_Al2O3C_Measurement(
  object = data_EnvD, 
  irradiation_time_correction = results_ITC, 
  cross_talk_correction = results_CT, 
  verbose = FALSE, plot = FALSE)
```

For this example six Al$_{2}$O$_{3}$:C chips have been measured. The function returns an object
of type `RLum.Results`:

```{r}
results_EnvD
```

To access the numerical results the given data objects within the `RLum.Results` object can be 
accessed using the `$` sign:

```{r, eval = FALSE}
results_EnvD$data
```

```{r, echo = FALSE}
knitr::kable(results_EnvD$data)
```

This table is as `data.frame` and can be further treated with standard methods in **R**. For example, 
the table show one extreme value on position (the first row). This value has obviously no meaning and 
indeed, here the value was biased due to a technical error and should be removed from the data set.

```{r}
results_table <- results_EnvD$data[-1,]
```

In a last step the results can be plotted, e.g., using the Abancio Plot (Dietze et al., 2016).

```{r, fig.width = 6, fig.height=5, warning=FALSE, message=FALSE, fig.align="center"}
plot_AbanicoPlot(
  data = results_table[,1:2], 
  zlab = expression(paste(D[e], " [s]")),
  main = "Dose Distribution", 
  summary = c("n", "mean", "sd.abs", "sd.rel")
  )
```

##Further analysis

To further data processing steps might be of particular interest in the given context: 

### Travel dosimeter(s)

Usually, the data set to analyse contains chips, which were used as travel dosimeters, i.e. this chips were reset in the field at the time the other dosimeters were taken and then transported
along with the field dosimeters. The dose of the travel dosimeters is subtracted from the measured dose of the field dosimeters. This can be done manually or automatically using the argument `travel_dosimeter` in the function `analyse_Al2O3C_Measurement()`. For the data set given above the analysis can be used 
as follows, assuming that the travel dosimeters were placed on measurement position 2 and 3:  

```{r, echo = TRUE}
results_EnvD_alternative <- analyse_Al2O3C_Measurement(
  object = data_EnvD[-1], 
  travel_dosimeter = c(2,3),
  irradiation_time_correction = results_ITC, 
  cross_talk_correction = results_CT, 
  verbose = FALSE, 
  plot = FALSE)
results_EnvD_alternative
```

The original data set remains untouched, but the now the returned object contains a new, additional, object called `data_TDcorrected` with the corrected values: 

```{r}
results_EnvD_alternative$data_TDcorrected
```

### Gray to seconds 

So far all returned values had the unit s (seconds), however, usually, the energy dose is wanted. 
To transform the values from the time domain to the dose domain, the function `Second2Gray()` 
can be used. Please make sure that you recalculate your calibration values to the measurement date.

# Ease your workflow

The analysis steps for the irradiation time correction and the irradiation cross-talk estimation 
might do not want to be repeated for every analysis. Thus, **R** allows the save results 
and recall them for the next analysis using the functions `save()` and `load()` 

```{r, eval = FALSE}
save(list = c("results_CT", "results_ITC"), file = "MyResults.Rdata")
load(file = "MyResults.Rdata")
```

# References {-}

Dietze, M., Kreutzer, S., Burow, C., Fuchs, M.C., Fischer, M., Schmidt, C., 2016. The abanico plot: visualising chronometric data with individual standard errors 31, 12–18. [doi:10.1016/j.quageo.2015.09.003](https://doi.org/10.1016/j.quageo.2015.09.003)

Kreutzer, S., Martin, L., Guérin, G., Tribolo, C., Selva, P., Mercier, N., in press. Environmental Dose Rate 
Determination Using a Passive Dosimeter: Techniques and Workflow for alpha-Al2O3:C Chips. 
Gechromometrie 45, 56-67. [doi: 10.1515/geochr-2015-0086](https://doi.org/10.1515/geochr-2015-0086)

Richter, D., Richter, A., Dornich, K., 2015. Lexsyg smart — a luminescence detection system for dosimetry, material research and dating application. Geochronometria 42, 202–209. [doi: 10.1515/geochr-2015-0022](https://doi.org/10.1515/geochr-2015-0022)
