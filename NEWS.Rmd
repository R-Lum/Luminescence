---
output:
  md_document:
    variant: gfm # github flavored markdown
header-includes:
   - \usepackage{amsmath}
   - \usepackage{amssymb}
---
<!-- NEWS.md was auto-generated by NEWS.Rmd. Please DO NOT edit by hand!-->

# Changes in version `r RLumBuild::.get_pkg_version()` (`r Sys.Date()`)

## New functions

* `correct_PMTLinearity()`A little helper to correct luminescence signals for
count linearity, if measured with a PMT (#920).

## New datasets

## Removed functions and deprecations

* Functions `calc_Kars2008()` (defunct since 0.9.26), `Analyse_SAR.OSLdata()`
(since 1.0.0), `PSL2Risoe.BINfileData()` (since 1.0.0) and `Second2Gray()`
(since 1.0.0) have been removed from the package. Their functionality can be
found in functions `calc_Huntley2006()`, `analyse_SAR.CWOSL()`,
`convert_PSL2Risoe.BINfileData()` and `convert_Second2Gray()`, respectively.

* Function `get_Risoe.BINfileData()` has been removed as it was not used and
provided no benefits to the user (#945).

## Breaking changes

## Bugfixes and changes

## `add_metadata<-()`
* The function throws an error if trying to assign a `NULL` value instead of
silently ignoring it (#946).

### `apply_CosmicRayRemoval()`

* The argument `method` for `method = "smooth_RLum()"` was not reachable and
would lead to a crash if called. Now the `<...>` argument is called
`method_smooth_RLum` and works as expected. 

### `analyse_Al2O3C_Measurement()`

* The function allows to specify the `cross_talk_argument` as a numeric vector
of length 3, as was already documented (#930).

### `analyse_SAR.CWOSL()`

* The function crashed if any of the curves had `NA` as its `recordType`
(#867).

### `calc_AliquotSize()`

* The legend text now scales better at non-default cex settings (#849).

### `calc_Huntley2006()`

* If the user set the `n.MC` argument, this was also used in the fitting of
the dose response curve. This was not the expected behaviour, and resulted
in poor performance (a 2x slowdown for `n.MC = 10000`). This regression was
introduced in version 1.0.0 (#867).

### `calc_MaxDose()`

* The function crashed if `sigmab` was set to a very small value (#898).

### `calc_MinDose()`

* The function crashed when bootstrapping with `bs.M = 1`. Now the `bs.M`
parameter is silently reset to 2 in that case, although such low values are
discouraged as they may trigger a warning during loess fitting (#900).

* The function crashed when all rows in the input data set contained `NA`
values (#915).

### `calc_Statistics()`

* The computation of the weighted median is now correct, while before it
corresponded to the simple (unweighted) median (#905).

### `fit_CWCurve()`

* The function hanged on particularly small datasets as it tried to fit too
many components for the available data (#953).

### `fit_DoseResponseCurve()`

* For `mode = "interpolation"`, the object returned contains an additional
`De.raw` column, which stores the calculated De value computed by the fitting
function 'as is', without setting meaningless results to `NA`. Therefore, the
only difference between the `De` and `De.raw` columns is that the first sets
the De to `NA` if negative, while the latter doesn't. It is then up to the
user to decide what to do with those values, bearing in mind that they may be
arbitrary when negative (#957).

### `fit_LMCurve()`

* The automated correction of the x-axis in case of `0` for lowest value threw 
the correct warning but actually did nothing; fixed. 

### `fit_OSLLifeTimes()`

* The function ensures that the `signal_range` argument doesn't contain
negative values instead of crashing (#896).

### `get_RLum()`

* The function doesn't crash anymore on `RLum.Analysis` objects if
`record.id` removes all available records (#873).

* An internal optimization increased the performance of the function. The
difference is not perceivable on single calls to `get_RLum()`, but the change
brings a visible speed up when `merge_RLum()` is called over a sufficiently
large number of `RLum.Analysis` objects (#875).

### `merge_Risoe.BINfileData()`

* The function gained argument `verbose` to allow disabling the output from
`read_BIN2R()` and `write_R2BIN()` (#950).

### `plot_AbanicoPlot()`

* The positioning of the y-axis label has been improved to be centred around
the zero line (#847). The z-axis tickmarks and labels are better drawn at
non-default cex values (#865).

* The minor grid lines were drawn incorrectly in a rotated plot (#849).

* Some plot elements didn't scale correctly at non-default cex values (#861,
#879).

* The `frame` argument is now respected also when the plot is rotated (#863).

* The weighted median is computed correctly when `summary = "median"` and
`summary.method = "weighted"` are used (#905).

### `plot_DoseResponseCurve()`

* The legend did not match anymore the plotted regeneration/dose points. This was
fixed including affected functions such as `analyse_SAR.CWOSL()` and `analyse_pIRIRSequence()` 

### `plot_DRTResults()`

* Points didn't scale correctly at non-default `cex` values (#879).
* Option `summary = "weighted$median"` is now officially supported (#905).

### `plot_Histogram()`

* Option `summary = "median.weighted"` is now officially supported (#905).

### `plot_KDE()`

* Outlier points didn't scale correctly at non-default `cex` values (#879).

* The weighted median is computed correctly when `summary = "median"` and
`summary.method = "weighted"` are used (#905).

### `plot_RadialPlot()`

* Option `summary = "median.weighted"` is now officially supported (#905).

### `plot_RLum.Analysis()`

* The legend text now scales better at non-default `cex` settings (#854).

### `plot_RLum.Data.Curve()`

* The function gained a new logical argument `interactive` that enables interactive
plotting of curves using `plotly::plot_ly()`. It requires the suggested package 
`'plotly'` to be present (#e4746ea).

### `plot_RLum.Data.Spectrum()`

* Types `image` and `contour` gained more control of the contour line labels through the argument `labcex`.

* For plot types `"image"` and `"multiple.lines"` the `...` argument `legend` (`TRUE` \ `FALSE`) was added.

* Plot type `"image"` further gained a legend with support through `...` for `legend.pos`, `legend.horiz` and `n_breaks` to
control the number of colours in the graphic.

### `plot_DoseResponseCurve()`

* We added support for the `log` graphical parameter, which can be used if
the fit was obtained with mode other than `"extrapolation"` (#820).

* The normal curve drawn as part of the histogram plot could appear very
jagged or even as a straight line, as it could happen that too few points
were actually used when drawing the curve (#843).

### `read_BIN2R()`

* The `FNAME` metadata field is no longer left empty if the BIN-file didn't
specify one, but it's populated with the BIN-file name without extension.
This is the behaviour that was present up to version 0.9.26, but version 1.0.0
had regressed it (#928).

### `read_XSYG2R()`

* Add support for the new function `correct_PMTLinearity()` (#920).

### `smooth_RLum()`

* Add support for the Poisson smoother of Carter et al. (2018), which can
be accessed by setting `method = "Carter_etal_2018"`. This is helpful to
ensure that the dark-background counts signals measured by a photomultiplier
tube follow a Poisson statistic, and smooths non-conforming values according
to an average over four neighbours (#921).

### `trim_RLum.Data()`

* The function crashed if both values specified in the `trim_range` argument
  exceeded the number of channels available (#871).
