---
output:
  md_document:
    variant: gfm # github flavored markdown
header-includes:
   - \usepackage{amsmath}
   - \usepackage{amssymb}
---
<!-- NEWS.md was auto-generated by NEWS.Rmd. Please DO NOT edit by hand!-->

# Changes in version `r RLumBuild::.get_pkg_version()` (`r Sys.Date()`)

## Breaking changes

More information on these changes are available at
https://replay.geog.uni-heidelberg.de/REPLAY-website/post/2026/01/upcoming-breaking-changes-in-luminescence/.

* All import functions will now always append the detector used to the
`recordType` slot of the `RLum.Data.Curve` object generated, for consistency
with what has always been done by `read_XSYG2R()`. The following functions
have been modified to support this new behaviour:
  - `read_Daybreak2R()`
  - `read_PSL2R()`
  - `read_RF2R()`
  - `read_SPE2()`
  - `Risoe.BINfileData2RLum.Data.Curve()`
In most cases, this is the string "(PMT)" for BIN/BINX, PSL and Daybreak files;
in the remaining cases the string "(NA)" is appended. The following example
files have been updated to reflect these changes:
  - `ExampleData.RLum.Analysis`
  - `ExampleData.portableOSL`
As a consequence of these changes, default titles for curve plots will now
also contain the detector string. This may potentially disrupt code that uses
strict equality (`==`) when selecting curves based on their `recordType`
(#1275, #1286).

* Function `read_XSYG2R()` will now prepend an underscore to the `recordType`
slot of the `RLum.Data.Curve` object generated from an XSYG file for all
objects after the first curve in a record. This will allow an easier way to
differentiate the curves to analyse (for example, "OSL (UVVIS") from those
that are not useful in the analysis (for example, "_OSL (NA)") (#1276).

* Function `calc_OSLLxTxRatio()` adds two new columns, `SN_RATIO_LnLx` and
`SN_RATIO_TnTx`, to the output. This may potentially disrupt code that relies
on column indices instead of column names (#1281).

## New functions

* `normalise_RLum()`: This function enables a fast normalisation of
`RLum.Data.Curve-class`, `RLum.Data.Spectrum-class`, `RLum.Data.Image-class`
and their combination in `RLum.Analysis-class` objects. Normalisation was
already possible for plotting (e.g., `plot_RLum.Data.Curve(…, norm = TRUE)`),
which uses an internal function called `.normalise_curves()` to do the job.
With `normalise_RLum()` we expose this functionality to `RLum-class` objects
and enable a convenient normalisation of values that might come in handy in
same cases. Normalised values are only count values. Currently implemented is
normalisation via keywords, such as `"max"`, `"min"`, `"first"`, `"last"`,
`"huot"`, `"intensity"`. Additionally, the function supports normalisation to
a positive number (#1250 by @RLumSK, #1300).

* `read_BINXLOG2R()`: This function enables you to salvage log files created
by a Risø reader into R as `RLum.Analysis-class`. The function also allows the 
export of these files into a BIN/BINX format. While the function has been
tested on a few examples, it is important to note that log files are not a
well-defined data format. This function is intended for use in cases where you
have a corrupted BIN/BINX file but a complete log file is still available.
Supported log formats are TL, OSL, and OSL curves. All other formats are
ignored (#1241 by @RLumSK; thanks to Michael Kenzler for bringing this to our
attention).

## Removed functions and deprecations

* Functions `github_branches()`, `github_commits()`, `github_issues()`,
`is.RLum()`, `is.RLum.Analysis()`, `is.RLum.Data()`, `is.RLum.Data.Curve()`,
`is.RLum.Data.Image()`, `is.RLum.Data.Spectrum()` and `is.RLum.Results()`
(deprecated since 1.1.2) have been removed (#1242).

## Bugfixes and changes

### `analyse_Al2O3C_ITC()`

* The function used to output a suppressed error message instead of validating
the input ahead of that (#1256).

### `analyse_baSAR()`

* The function has been updated to use `fit_DoseResponseCurve()` and
`plot_DoseResponseCurve()` instead of `plot_GrowthCurve()`. This should not
have any visible difference other than the renaming of two arguments:
`output.plot` has been renamed to `plot_drc`, while `output.plotExtended` has
been renamed to `plot_extended`. The older names will still work but generate
a deprecation warning (#1244).

* Arguments `signal.integral`, `background.integral`, `signal.integral.Tx` and
`background.integral.Tx` have been renamed to `signal_integral`,
`background_integral`, `signal_integral_Tx` and `background_integral_Tx`,
respectively. The older names will still work but generate a deprecation
warning (#1290).

### `analyse_FadingMeasurement()`

* The plots were affected by a bug in `plot_RLum.Analysis()`, so that the
output was unnecessarily split over two pages (#1247).

* Arguments `signal.integral` and `background.integral` have been renamed to
`signal_integral`, `background_integral`, respectively. The older names will
still work but generate a deprecation warning (#1290).

### `analyse_IRSAR.RF()`

* The `slide$squared_residuals` field of the `@data` slot in the `RLum.Results`
object returned by the function is no longer a 1-column matrix, but a plain
numeric vector (#1254).

### `analyse_pIRIRSequence()`

* Arguments `signal.integral.min`, `signal.integral.max`,
`background.integral.min` and `background.integral.max` have been replaced
by `signal_integral` and `background_integral`: each of them now defines a
vector of channels for the respective integrals. The older names will still
work but generate a deprecation warning (#1290).

### `analyse_portableOSL()`

* Argument `signal.integral` has been renamed to `signal_integral`. The older
name will still work but generates a deprecation warning (#1290).

### `analyse_SAR.CWOSL()`

* No automated resetting of the dose value anymore, if `mode = "alternate"`.
If the first dose point was > 0, the function detected a dose-recovery test
and automatically reset this dose point to 0. While this is likely convenient
in 9 out of 10 cases, it caused trouble if the `mode = "alternate"` (passed on 
to `fit_DoseResponseCurve()`) because it modified the first dose point and this
required additional handling afterwards. Please keep in mind that you
have to redefine the recuperation reference in such a case: this is wanted
and not a bug (#9ff29bfd).

* The order of columns in the `rejection.criteria` data frame that is output
by the function has been changed so that the `UID` column appears now first.
This is meant to facilitate seeing visually to what aliquot each criteria
belongs to. While the `UID` values are random-looking alphanumeric values,
they can identify univocally an aliquot also after merge operations (#1172).

* Add new argument, `dose_rate_source`, that allows users to specify a value for 
the source dose rate and display values in Gy, rather than seconds. Previously, 
this was possible by using a factor with the `dose.points` argument. However, 
setting it manually was particularly inconvenient if the dose points were 
already extracted automatically, as it required users to manually insert dose 
values regardless of the automated extraction. This argument is also available 
in other functions that wrap around `analyse_SAR.CWOSL()` (#4fc985d).

* The function warns if the most common curve type (which is the one used in
the analysis) matches multiple record types, as this may be a sign that the
user has forgotten to select the correct set of curves to analyze (#1269).

* A new signal-to-noise ratio rejection criterion has been added, with
default threshold of 50 (controllable by setting the `sn.ratio` parameter in
the `rejection.criteria` list to a different value). By default it uses the
signal-to-noise value computed for the natural curve, but a different curve
can be specified via the `sn_reference` parameter in the `rejection.criteria`
list (#1284).

* Arguments `signal.integral.min`, `signal.integral.max`,
`background.integral.min` and `background.integral.max` have been replaced
by `signal_integral`, `background_integral`, `signal_integral_Tx` and
`background_integral_Tx`: each of them now defines a vector of channels for
the respective integrals. The older names will still work but generate a
deprecation warning (#1290).

* When rejection criteria are set to `NA`, in the plot we now only show the
value calculated (say, 1.1) instead of incorrectly showing `NA`s for both the
sign and the threshold (as in `1.1 NA NA`) which would look ugly and confusing
(#1318).

## `analyse_SAR.TL()`

* Argument `signal.integral` has been renamed to `signal_integral`. The older
name will still work but generate a deprecation warning (#1290).

### `calc_gSGC()`

* The function no longer crashes in `n.MC` is set to 0 (#1327).

### `calc_MinDose()`

* The function now set non-positive De values to `NA` when `log = TRUE`, which
used to lead to a crash when combined with `bootstrap = TRUE` (#1313).

### `calc_OSLLxTxRatio()`

* The function now returns `SN_RATIO_LnLx` and `SN_RATIO_TnTx`. This is the 
signal-to-noise ratio for the respective shine-down curves for `Lx` and `Tx` (#1281). 

* Arguments `signal.integral`, `background.integral`, `signal.integral.Tx` and
`background.integral.Tx` have been renamed to `signal_integral`,
`background_integral`, `signal_integral_Tx` and `background_integral_Tx`,
respectively. The older names will still work but generate a deprecation
warning (#1290).

### `calc_TLLxTxRatio()`

* Argument `signal.integral` has been renamed to `signal_integral`. The older
name will still work but generate a deprecation warning (#1290).

### `convert_CW2pHMi()` and `convert_CW2pPMi()`

* The function now checks if the results of the approximation step are not
valid because all points lie outside of the computed interpolation range,
which can happen if the input data is misspecified (#1295).

### `correct_PMTLinerarity()` 
* The function introduced with the last release, unintentionally came with a major flaw: 
It did nothing on a single `RLum.Data.Curve()` object; fixed (#1d978cf). 
* If the channel resolution was not changing, the function produced `NaN` values even 
in cases where dead time was not corrected; fixed (#1d978cf).

### `fit_DoseResponseCurve()`

* The C++ implementation of the GOK function has been tweaked to avoid some
repeated computations in a loop. Given the different ordering of computations
(although mathematically equivalent), there will be small differences in the
numerical output when `fit.method = "GOK"` is used (#1277).

### `get_RLum()`

* An internal optimization increased the performance of the function by over
50% in some particular cases, such as when merging a large number of
`RLum.Analysis` object (#1271).

### `plot_DetPlot()`

* When operating on a list with the default setting of `multicore = TRUE`, the
function limits the size of the parallel cluster to the number of list
elements to process (#1258).

* Arguments `signal.integral.min`, `signal.integral.max`,
`background.integral.min` and `background.integral.max` have been replaced
by `signal_integral`, `background_integral`, `signal_integral_Tx` and
`background_integral_Tx`: each of them now defines a vector of channels for
the respective integrals. The older names will still work but generate a
deprecation warning (#1290).

### `plot_RLum.Analysis()`

* The ability to combine multiple plots on a single page regressed in v1.1.2,
causing plots intended to appear side-by-side to be rendered on separate pages
(#1247).

### `plot_RLum.Data.Spectrum()`

* The `norm` argument is no longer limited to just `"min"` and `"max"` but
now supports all options provided by `normalise_RLum()` (#1303).

* The function now returns `NULL` (instead of producing an empty plot or
crashing) whenever the normalisation step replaces all values with zeroes,
which can happen if the normalisation term used is 0, for example when the
`bg.spectrum` argument is used and `norm = "min"` (#1305).

* Setting `log = "z"` will produce a warning if the data contains non-positive
values (for example after background subtraction or normalisation) before
setting those values to `NA`. This avoids producing infinities or NaN values
that would lead to crashes for some plot types (#1307).

### `plot_FilterCombinations()`

* The interactive mode did not accept all plotting options from the non-interactive
mode (the default); fixed (#c27a656).

* If the functions was used on a shiny server, the plot showed only after the app 
was closed; fixed (#c27a656).

### `plot_RadialPlot()`

* If the error column contains zero values, they are reset to the smallest
between the non-zero errors in the dataset and 10-9. This avoids a crash when
using the argument `centrality = "mean.weighted"`, which is the default for
this function (#1314).

* The weighted median used to compute the central values when
`centrality = "median.weighted"` now uses the precision as weight (similarly
to what is done for the weighted mean), while before it incorrectly used the
error (#1323).

### `read_BIN2R()`

* The function could crash if called with `do.call()` and some particularly
odd inputs (#1260).

### `read_Daybreak2R()`

* The function struggled with variable header lengths (#1262; thanks to
@andrzejbluszcz for reporting).

* The function will no longer crash if the data point entries have more than
four columns (thanks to @andrzejbluszcz for reporting).

* The import of binary `.DAT` files has been overhauled and made more correct;
moreover, the function accepts both `.DAT` and `.dat` extensions for binary
inputs, and supports `DataType=Command` records in ASCII files (#1263, #1266;
thanks to @andrzejbluszcz for contributing code and datasets).

* Trying to import multiple files by specifying a directory name failed
because the generated path missed a directory separator (#1264).

### `read_XSYG2R()`

* Attributes from the record level are now all included in the `@info` slot,
as long as they do not duplicate the attributes from the curve level. Hence,
those attributes are now available for filtering (#1239; thanks to
@DirkMittelstrass for reporting).

* The function could crash if called with `do.call()` and some particularly
odd inputs (#1260).

### `report_RLum()`

* The function could crash if called with `do.call()` and some particularly
odd inputs (#1260).

## Other changes

* The internal function `.normalise_curve()` received support to normalise
by the minimum value (`"min"`), the first value (`"first"`), the channel
length (`"intensity"`) or a positive number (e.g, 2.2). These new settings are
automatically available to `plot_RLum.Analysis()` and the `plot_RLum.Data.*()`
functions (#1250, #1300).

* The package no longer depends on `RcppArmadillo`. This has no visible
impact to the user other than a small reduction in the package size (#1254).
